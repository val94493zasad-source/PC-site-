<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Checkout — TechFix</title>
    <style>
        :root{--accent:#7dd3fc;--muted:#e6f9ff}
        body{font-family:Segoe UI,Arial,sans-serif;background:#071425;color:var(--muted);padding:28px;line-height:1.5}
        .card{max-width:760px;margin:20px auto;background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
        h1{color:var(--accent);margin-bottom:8px}
        label{display:block;margin-top:12px;font-weight:600}
        input[type=text], input[type=email], textarea, select{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted)}
        .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .summary{background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;margin-top:12px}
        .submit{display:inline-block;margin-top:14px;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#6ad1f0);color:#042029;font-weight:800;border:none;cursor:pointer}
        .muted{color:#a9dbe9;font-size:0.95em}
        /* Info bubble (white background, dark text) */
        .info-bubble {
            position: fixed;
            background: #ffffff;
            color: #071425;
            padding: 10px 14px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            border: 1px solid rgba(10,14,39,0.06);
            font-weight: 700;
            z-index: 1000;
            pointer-events: auto;
            transition: transform 160ms ease, opacity 160ms ease;
            opacity: 0;
        }
        .info-bubble.show {
            opacity: 1;
            transform: translateY(0);
        }
        .info-bubble a.goto {
            display: inline-block;
            margin-left: 8px;
            background: transparent;
            color: var(--accent);
            font-weight: 900;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="card">
        <p><a href="TechfixBeginPage.html" class="info-link" data-info="Върни се на началната страница" data-href="TechfixBeginPage.html">← Назад</a></p>
        <h1>Финализиране на поръчката</h1>
        <p class="muted">Попълнете данните за доставка и начин на плащане. Прегледайте поръчката вдясно.</p>

        <div style="display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px">
            <div>
                <form id="checkoutForm">
                    <label for="name">Име и фамилия</label>
                    <input id="name" name="name" type="text" required>

                    <label for="phone">Телефон</label>
                    <input id="phone" name="phone" type="text" required>

                    <label for="email">Email</label>
                    <input id="email" name="email" type="email" required>

                    <label for="address">Адрес за доставка</label>
                    <textarea id="address" name="address" rows="3" required></textarea>

                    <div class="row">
                        <div>
                            <label for="payment">Начин на плащане</label>
                            <select id="payment" name="payment">
                                <option value="card">Карта (онлайн)</option>
                                <option value="paypal">PayPal</option>
                                <option value="cod">Наложен платеж (налично)</option>
                            </select>
                        </div>
                        <div>
                            <label for="delivery">Доставка</label>
                            <select id="delivery" name="delivery">
                                <option value="standard">Стандартна (2-5 работни дни)</option>
                                <option value="express">Експрес (1-2 дни)</option>
                                <option value="pickup">Вземане от магазин</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="submit">Плати / Потвърди</button>
                </form>
            </div>

            <div>
                <div class="summary">
                    <h3>Резюме на поръчката</h3>
                    <div id="orderItems"></div>
                    <div style="margin-top:12px;font-weight:700">Общо: <span id="orderTotal">€0.00</span></div>
                </div>
                <p style="margin-top:12px;font-size:0.95em;color:#bfeafc">Бележка: Това е примерна страница за плащане. Реална плащателна интеграция не е реализирана.</p>
            </div>
        </div>
    </div>

    <script>
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const orderItemsEl = document.getElementById('orderItems');
        const orderTotalEl = document.getElementById('orderTotal');
        function renderOrder() {
            orderItemsEl.innerHTML = '';
            let total = 0;
            if (!cart || cart.length === 0) {
                orderItemsEl.innerHTML = '<p class="muted">Кошницата е празна.</p>';
            } else {
                cart.forEach(it => {
                    const div = document.createElement('div');
                    div.style.display = 'flex';
                    div.style.justifyContent = 'space-between';
                    div.style.padding = '6px 0';
                    div.innerHTML = `<span>${it.name}</span><span>€${it.price.toFixed(2)}</span>`;
                    orderItemsEl.appendChild(div);
                    total += Number(it.price || 0);
                });
            }
            orderTotalEl.textContent = '€' + total.toFixed(2);
        }
        renderOrder();

        // Pre-fill with previously saved contact if exists
        const saved = JSON.parse(localStorage.getItem('customer') || '{}');
        if (saved.name) document.getElementById('name').value = saved.name;
        if (saved.email) document.getElementById('email').value = saved.email;
        if (saved.phone) document.getElementById('phone').value = saved.phone;
        if (saved.address) document.getElementById('address').value = saved.address;

        document.getElementById('checkoutForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if (!cart || cart.length === 0) { alert('Кошницата е празна'); return; }
            const data = {
                name: document.getElementById('name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                address: document.getElementById('address').value.trim(),
                payment: document.getElementById('payment').value,
                delivery: document.getElementById('delivery').value,
                items: cart,
                total: orderTotalEl.textContent
            };
            // basic validation
            if (!data.name || !data.phone || !data.address || !data.email) { alert('Моля попълнете задължителните полета.'); return; }

            // save customer for convenience
            localStorage.setItem('customer', JSON.stringify({ name: data.name, email: data.email, phone: data.phone, address: data.address }));

            // save order (local demo)
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            orders.push({ ...data, date: new Date().toISOString() });
            localStorage.setItem('orders', JSON.stringify(orders));

            // clear cart
            localStorage.removeItem('cart');

            // show confirmation and redirect back
            alert('Благодарим! Поръчката е приета. Ще получите имейл с информация.');
            window.location.href = 'TechfixBeginPage.html';
        });
    </script>
    <script>
        (function(){
            let bubble = null;
            let showT = null, hideT = null;

            function createBubble(text, href) {
                const b = document.createElement('div');
                b.className = 'info-bubble';
                b.innerHTML = `<span>${text}</span>` + (href ? ` <a class="goto" href="${href}">Отиди</a>` : '');
                document.body.appendChild(b);
                return b;
            }

            function positionBubble(b, target) {
                const r = target.getBoundingClientRect();
                const bw = b.offsetWidth, bh = b.offsetHeight;
                let top = r.top - bh - 8;
                let left = r.left + (r.width/2) - (bw/2);
                if (top < 8) top = r.bottom + 8;
                if (left < 8) left = 8;
                if (left + bw > window.innerWidth - 8) left = window.innerWidth - bw - 8;
                b.style.top = top + 'px';
                b.style.left = left + 'px';
            }

            function showFor(target) {
                const text = target.getAttribute('data-info') || '';
                const href = target.getAttribute('data-href') || '';
                if (!text) return;
                if (bubble) { bubble.remove(); bubble = null; }
                bubble = createBubble(text, href);
                requestAnimationFrame(() => {
                    positionBubble(bubble, target);
                    bubble.classList.add('show');
                });
            }

            function hideBubble() {
                if (!bubble) return;
                bubble.classList.remove('show');
                setTimeout(() => { if (bubble) { bubble.remove(); bubble = null; } }, 160);
            }

            document.querySelectorAll('.info-link').forEach(el => {
                el.addEventListener('mouseenter', () => {
                    clearTimeout(hideT);
                    showT = setTimeout(() => showFor(el), 180);
                });
                el.addEventListener('mouseleave', () => {
                    clearTimeout(showT);
                    hideT = setTimeout(hideBubble, 180);
                });
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hideBubble();
            });
        })();
    </script>
</body>
</html>
